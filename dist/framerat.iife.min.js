/** MIT License
* 
* Copyright (c) 2011 Ludovic CLUBER
* 
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
* 
* The above copyright notice and this permission notice (including the next
* paragraph) shall be included in all copies or substantial portions of the
* Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
* 
* https://github.com/LCluber/FrameRat.js
*/

var FrameRat=function(t){"use strict";function e(t,n){for(var i=0;i<n.length;i++){var e=n[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function r(t){return t<10?"0"+t:t}function i(t){return function(t,n){void 0===n&&(n=!0);var i=parseInt(t,10);return n?t===i:t==i}(t)||function(t,n){void 0===n&&(n=!0);var i=t%1!=0;return n?Number(t)===t&&i:Number(t)==t&&i}(t)}var c=function(){function t(){}return t.round=function(t,n){return n=Math.pow(10,n),Math.round(t*n)/n},t.floor=function(t,n){return n=Math.pow(10,n),Math.floor(t*n)/n},t.ceil=function(t,n){return n=Math.pow(10,n),Math.ceil(t*n)/n},t.trunc=function(t,n){var i=+t*(n=Math.pow(10,n));return isFinite(i)?(i-i%1)/n||(i<0?-0:0==i?i:0):i},t.roundToNearest=function(t,n){return Math.round(t/n)*n},t.mix=function(t,n,i){return(1-i)*t+i*n},t.sign=function(t){return t?t<0?-1:1:0},t.opposite=function(t){return-t},t.clamp=function(t,n,i){return Math.min(Math.max(t,n),i)},t.normalize=function(t,n,i){return(t-n)/(i-n)},t.lerp=function(t,n,i){return(i-n)*t+n},t.map=function(t,n,i,e,r){return this.lerp(this.normalize(t,n,i),e,r)},t.isEven=function(t){return!(1&t)},t.isOdd=function(t){return 1&t},t.isOrigin=function(t){return 0===t},t.isPositive=function(t){return 0<=t},t.isNegative=function(t){return t<0},t.contains=function(t,n,i){return n<=t&&t<=i},t}(),n=function(){function i(){}return i.init=function(){i.createRoundedPis(),i.createFactorialArray()},i.createRoundedPis=function(){this.pi=c.round(Math.PI,2),this.twopi=c.round(2*Math.PI,2),this.halfpi=c.round(.5*Math.PI,2)},i.createFactorialArray=function(){for(var t=3*this.sineLoops[this.sineLoops.length-1],n=2*this.cosineLoops[this.cosineLoops.length-1],i=1,e=1;i<=Math.max(t,n);i++)e*=this.factorial(i),this.factorialArray.push(e)},i.factorial=function(t){return 1<t?t-1:1},i.setSinePrecision=function(t){return t<this.sineLoops.length?this.sineDecimals=t:this.sineDecimals=2},i.setCosinePrecision=function(t){return t<i.cosineLoops.length?this.cosineDecimals=t:this.cosineDecimals=2},i.setArctanPrecision=function(t){return t<i.arctanLoops.length?this.cosineDecimals=t:this.arctanDecimals=2},i.degreeToRadian=function(t){return t*this.pi/180},i.radianToDegree=function(t){return 180*t/this.pi},i.normalizeRadian=function(t){return t>this.pi||t<-this.pi?t-this.twopi*Math.floor((t+this.pi)/this.twopi):t},i.sine=function(t){return t=this.normalizeRadian(t),i.sineDecimals<=2&&t<.28&&-.28<t?t:this.taylorSerie(3,i.sineLoops[this.sineDecimals],t,t,!0)},i.cosine=function(t){var n=(t=this.normalizeRadian(t))*t;return this.cosineDecimals<=2&&t<=.5&&-.5<=t?1-.5*n:this.taylorSerie(2,i.cosineLoops[this.cosineDecimals],1,t,!0)},i.arctan2=function(t,n){var i=n/t;return 0<t?this.arctan(i):t<0?n<0?this.arctan(i)-this.pi:this.arctan(i)+this.pi:n<0?-this.halfpi:0<n&&this.halfpi},i.arctan2Vector2=function(t){return this.arctan2(t.x,t.y)},i.arctan=function(t){var n=i.arctanLoops[this.arctanDecimals];return t<1&&-1<t?this.taylorSerie(3,n,t,t,!1):1<=t?(t=1/t,-(this.taylorSerie(3,n,t,t,!1)-this.halfpi)):(t=-1/t,this.taylorSerie(3,n,t,t,!1)-this.halfpi)},i.sineEquation=function(t,n,i,e){return t*this.sine(n+i)+e},i.cosineEquation=function(t,n,i,e){return t*this.cosine(n+i)+e},i.arctanEquation=function(t,n,i,e){return t*this.arctan(n+i)+e},i.taylorSerie=function(t,n,i,e,r){for(var o=e*e,a=i,s=-1;t<=n;t+=2,0)a+=(i*=o)/(r?this.factorialArray[t]:t)*s,s=c.opposite(s);return a},i}();n.sineLoops=[9,11,13,15,17,18,19,21,23],n.cosineLoops=[6,8,10,12,14,16,18,20,22],n.arctanLoops=[17,19,21,23,25,27,29,31,33],n.sineDecimals=2,n.cosineDecimals=2,n.arctanDecimals=2,n.factorialArray=[],n.init();var o=function(){function t(){}return t.millisecondToSecond=function(t){return.001*t},t.secondToMilliecond=function(t){return 1e3*t},t.millisecondToFramePerSecond=function(t){return 1e3/t},t.framePerSecondToMillisecond=function(t){return 1e3/t},t}(),a=function(){function i(){}return i.min=function(t){return Math.min.apply(Math,t)},i.max=function(t){return Math.max.apply(Math,t)},i.sum=function(t){return t.reduce(function(t,n){return t+n},0)},i.multiply=function(t){return t.reduce(function(t,n){return t*n},0)},i.average=function(t,n){return i.sum(t)/n},i}(),s={info:{id:1,name:"info",color:"#28a745"},trace:{id:2,name:"trace",color:"#17a2b8"},warn:{id:3,name:"warn",color:"#ffc107"},error:{id:4,name:"error",color:"#dc3545"},off:{id:99,name:"off",color:null}},u=function(){function t(t,n){this.id=t.id,this.name=t.name,this.color=t.color,this.content=n,this.date=function(){var t=new Date,n=[r(t.getMonth()+1),r(t.getDate()),t.getFullYear().toString().substr(-2)],i=[r(t.getHours()),r(t.getMinutes()),r(t.getSeconds())];return n.join("/")+" "+i.join(":")}()}return t.prototype.display=function(){},t}(),f=function(){function t(t,n){this.messages=[],this.name=t,this.messages=[],this._level=n}var n=t.prototype;return n.info=function(t){this.log(s.info,t)},n.trace=function(t){this.log(s.trace,t)},n.warn=function(t){this.log(s.warn,t)},n.error=function(t){this.log(s.error,t)},n.log=function(t,n){var i=new u(t,n);this.messages.push(i),this._level.id<=i.id&&i.display(this.name)},function(t,n,i){n&&e(t.prototype,n),i&&e(t,i)}(t,[{key:"level",set:function(t){this._level=s.hasOwnProperty(t)?s[t]:this._level},get:function(){return this._level.name}}]),t}(),h=function(){function a(){}return a.setLevel=function(t){a.level=s.hasOwnProperty(t)?s[t]:a.level;var n=a.groups,i=Array.isArray(n),e=0;for(n=i?n:n[Symbol.iterator]();;){var r;if(i){if(e>=n.length)break;r=n[e++]}else{if((e=n.next()).done)break;r=e.value}r.level=a.level.name}},a.getLevel=function(){return a.level.name},a.getGroup=function(t){var n=a.groups,i=Array.isArray(n),e=0;for(n=i?n:n[Symbol.iterator]();;){var r;if(i){if(e>=n.length)break;r=n[e++]}else{if((e=n.next()).done)break;r=e.value}var o=r;if(o.name===t)return o}return null},a.addGroup=function(t){return this.getGroup(t)||this.pushGroup(t)},a.pushGroup=function(t){var n=new f(t,a.level);return a.groups.push(n),n},a}();h.level=s.error,h.groups=[];function l(t){var n=this;this.state=t[0].from,this.log=h.addGroup("Taipan");function i(){if(r){if(o>=e.length)return"break";a=e[o++]}else{if((o=e.next()).done)return"break";a=o.value}var t=a;n.hasOwnProperty(t.name)||(n[t.name]=function(){return n.log.info("- Event "+t.name+" triggered"),n.state===t.from?(n.state=t.to,n.log.info("from "+t.from+" to "+n.state),!0):(n.log.warn("Cannot transition from "+n.state+" to "+t.to),!1)})}var e=t,r=Array.isArray(e),o=0;for(e=r?e:e[Symbol.iterator]();;){var a;if("break"===i())break}}var m=function(){function t(){this.fpsArrayLength=60,this.fpsArray=Array(this.fpsArrayLength),this.reset()}var n=t.prototype;return n.reset=function(){this.now=0,this.total=0,this.delta=0,this.ticks=0,this.fpsArray.fill(60)},n.start=function(){this.now=performance.now()},n.tick=function(t){this.now=t,this.total+=this.delta,this.fpsArray[this.ticks%60]=o.millisecondToFramePerSecond(this.delta),this.ticks++},n.computeDelta=function(t){return this.delta=t-this.now},n.computeAverageFPS=function(){return a.average(this.fpsArray,this.fpsArrayLength)},t}(),p=function(){function t(t){this.frameId=0,this.minDelta=0,this.clock=new m,this.callback=t,this.fsm=new l([{name:"start",from:!1,to:!0},{name:"stop",from:!0,to:!1}])}var n=t.prototype;return n.setMaxRefreshRate=function(t){this.minDelta=i(t)?o.framePerSecondToMillisecond(t):this.minDelta},n.getDelta=function(){return o.millisecondToSecond(this.clock.delta)},n.getTotal=function(){return o.millisecondToSecond(this.clock.total)},n.getFPS=function(){return this.clock.computeAverageFPS()},n.getTicks=function(){return this.clock.ticks},n.getState=function(){return this.fsm.state},n.start=function(){var t=this.fsm.start();return t&&this.startAnimation(),t},n.toggle=function(){return this.start()||this.pause()},n.pause=function(){return this.fsm.stop()&&this.stopAnimation(),!1},n.stop=function(){this.fsm.stop(),this.clock.reset(),this.stopAnimation()},n.tick=function(t){var n=!0,i=this.clock.computeDelta(t);(!this.minDelta||i>=this.minDelta)&&(this.clock.tick(t),!1===this.callback()&&(n=!1)),n?this.requestNewFrame():this.stop()},n.startAnimation=function(){this.clock.start(),this.requestNewFrame()},n.stopAnimation=function(){window.cancelAnimationFrame(this.frameId)},n.requestNewFrame=function(){this.frameId=window.requestAnimationFrame(this.tick.bind(this))},t}();return t.Player=p,t}({});