/** MIT License
* 
* Copyright (c) 2011 Ludovic CLUBER 
* 
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
*
* http://frameratjs.lcluber.com
*/

var FRAMERAT={revision:"0.2.8",id:null,onAnimate:function(){},tickCount:0,fsm:{},clock:{},frameId:0,options:{refreshRate:30},console:{},formated:{delta:0},create:function(t,e){var n=Object.create(this);return n.createOnAnimateCallback(t,e),n.createFiniteStateMachine(),n.createConsole(),n.clock=FRAMERAT.Clock.create(),n},createOnAnimateCallback:function(t,e){this.onAnimate=e?t.bind(e):t},createConsole:function(){this.console=FRAMERAT.Console.create(TYPE6.Vector2D.create(),TYPE6.Vector2D.create(20,20)),this.console.addLine("Elapsed time : {0}",this.getFormatedElapsedTime,this),this.console.addLine("Frame count : {0}",this.getFrameNumber,this),this.console.addLine("Frame Per Second : {0}",this.getFramePerSecond,this),this.console.addLine("Frame duration : {0}",this.getFormatedDelta,this),this.toggleConsole()},createFiniteStateMachine:function(){this.fsm=TAIPAN.create([{name:"play",from:"paused",to:"running"},{name:"pause",from:"running",to:"paused"}])},play:function(){return!!this.fsm.play()&&(this.clock.start(),this.requestNewFrame(),!0)},pause:function(){return!!this.fsm.pause()&&(this.cancelAnimation(),!0)},toggle:function(){return this.play()||this.pause(),this.fsm.getStatus()},stop:function(){return this.clock.init(),this.tickCount=0,!!this.pause()},getElapsedTime:function(){return this.clock.getElapsed()},getFormatedElapsedTime:function(){return TYPE6.MathUtils.round(this.getElapsedTime().getSecond(),2)},getDelta:function(){return this.clock.getDelta()},getFormatedDelta:function(){return this.tickCount%this.options.refreshRate==0&&(this.formated.delta=TYPE6.MathUtils.round(this.getDelta().getMillisecond(),2)),this.formated.delta},getFrameNumber:function(){return this.tickCount},getFramePerSecond:function(){return this.tickCount%this.options.refreshRate==0&&this.clock.computeFramePerSecond(),this.clock.getFramePerSecond()},newFrame:function(){this.requestNewFrame(),this.clock.tick()},requestNewFrame:function(){this.frameId=window.requestAnimationFrame(this.onAnimate),this.tickCount++},cancelAnimation:function(){window.cancelAnimationFrame(this.frameId)},drawConsole:function(t){this.console.draw(t)},toggleConsole:function(){this.console.toggle()}};FRAMERAT.Time={millisecond:0,second:0,create:function(t){var e=Object.create(this);return e.set(t||0),e},set:function(t){this.millisecond=t,this.second=this.millisecondToSecond(this.millisecond)},add:function(t){this.set(this.millisecond+t)},getSecond:function(){return this.second},getMillisecond:function(){return this.millisecond},millisecondToSecond:function(t){return.001*t}},FRAMERAT.Console={fontFamily:"Georgia",fontSize:20,fontColor:"rgba(60, 60, 60, 1)",font:"",position:null,padding:null,color:null,lineHeight:30,lines:[],nbLines:0,show:!1,create:function(t,e){var n=Object.create(this);return n.position=t,n.padding=e,n.lines=[],n.setFont(n.fontSize,n.fontFamily),n},setFont:function(t,e){this.font=t+"px "+e},setFontColor:function(t,e,n,i){this.fontColor="rgba("+t+", "+e+", "+n+", "+i+")"},addLine:function(t,e,n){var i=this.lineHeight,o=this.padding.getX();this.nbLines?i+=this.lines[this.nbLines-1].position.getY():i+=this.padding.getY(),this.nbLines++;var a=this.Line.create(TYPE6.Vector2D.create(o,i),t,e,n);this.lines.push(a)},draw:function(t){if(this.show){t.font=this.font,t.fillStyle=this.fontColor;for(var e=0;e<this.nbLines;e++){var n=this.lines[e];this.write(n.text.replace("{0}",n.callback),n.position,t)}}},write:function(t,e,n){n.fillText(t,e.getX(),e.getY())},toggle:function(){this.show=!this.show}},FRAMERAT.Console.Line={position:null,callback:null,text:"",create:function(t,e,n,i){var o=Object.create(this);return o.position=t,o.callback=n.bind(i),o.text=e,o}},FRAMERAT.Clock={old:performance.now(),new:performance.now(),fps:0,minimumTick:16,elapsed:{},delta:{},create:function(){var t=Object.create(this);return t.elapsed=FRAMERAT.Time.create(0),t.delta=FRAMERAT.Time.create(Math.max(0,t.minimumTick)),t},init:function(){this.fps=0,this.elapsed.set(0),this.delta.set(Math.max(0,this.minimumTick))},start:function(){this.old=performance.now()},tick:function(){this.new=performance.now(),this.delta.set(Math.max(this.new-this.old,this.minimumTick)),this.old=this.new,this.elapsed.add(this.delta.getMillisecond())},getElapsed:function(){return this.elapsed},getDelta:function(){return this.delta},computeFramePerSecond:function(){this.fps=Math.round(1e3/this.delta.getMillisecond())},getFramePerSecond:function(){return this.fps}},function(){if("performance"in window==!1&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==!1){var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-t}}}(),function(){for(var t=0,e=["ms","moz","webkit","o"],n=0;n<e.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var n=(new Date).getTime(),i=Math.max(0,16-(n-t)),o=window.setTimeout(function(){e(n+i)},i);return t=n+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();